{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Alert Creation Scenario",
    "aliasName": null,
    "tag": null,
    "description": "Playbook generated sample CVEs, ICS Advisory, KEV Alert and Alert to understand Nozomi Use Case",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/b9d86849-ad02-4b08-bacc-793c9e9c387b",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/b9930846-6b76-4976-b0ef-88a81106b5d7",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "8ab65a3a-e218-409c-a194-25b7af8f73f3",
                "resources": [
                    "alerts"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": true,
                "singleRecordExecution": false
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "b9930846-6b76-4976-b0ef-88a81106b5d7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update CVEs With ICS Advisory",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.cVE}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "__link": {
                        "recordTags": [],
                        "iCSAdvisories": "{{vars.cVEiCSAdvisoryDict[vars.item[\"@id\"]]}}"
                    }
                },
                "operation": "Append",
                "collection": "{{vars.item[\"@id\"]}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/c_v_es",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "98962208-3d6f-4b65-9958-43619ed06a4b"
        },
        {
            "@type": "WorkflowStep",
            "name": "Output",
            "description": null,
            "arguments": {
                "@id": "{{vars.recordIRI}}"
            },
            "status": null,
            "top": "1245",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "03551ca8-7d51-405d-88b7-2451ac00f25a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create KEV Alerts",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.kEVAlertData}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "kEVRecord": "{{vars.item}}",
                    "iCSAdvisoryIRI": "{% set output = vars.steps.Create_ICS_Advisory_Record | json_query(\"[?iCSCERTID == '\"+vars.item.iCSID+\"']\") %}{{output | json_query('[*][\"@id\"][]')}}"
                },
                "apply_async": false,
                "step_variables": {
                    "__dummy": "{{vars.recordIRI.extend(vars.steps.Create_KEV_Alerts | json_query('[*][\"kevIRI\"][]'))}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/e2038357-11fd-4ed8-8846-58ab32f61d6a"
            },
            "status": null,
            "top": "975",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "335ddb91-9138-4315-bc5f-777f81bad82b"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create ICS Advisory Record",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.iCSAdvisoryData}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "year": "{{vars.item.year}}",
                    "cVEID": "{{vars.item.cVEID}}",
                    "cWEID": "{{vars.item.cWEID}}",
                    "vendor": "{{vars.item.vendor}}",
                    "iCSAUrl": "{{vars.item.iCSAUrl}}",
                    "product": "{{vars.item.product}}",
                    "__replace": "false",
                    "iCSCERTID": "{{vars.item.iCSCERTID}}",
                    "recordTags": "{{vars.item.recordTags}}",
                    "sourceData": "{{vars.item.sourceData}}",
                    "lastUpdated": "{{vars.item.lastUpdated}}",
                    "cVSSSeverity": "{{vars.item.cVSSSeverity['@id']}}",
                    "iCSCERTTitle": "{{vars.item.iCSCERTTitle}}",
                    "cumulativeCVSS": "{{vars.item.cumulativeCVSS}}",
                    "affectedProducts": "{{vars.item.affectedProducts}}",
                    "companyHeadquarters": "{{vars.item.companyHeadquarters}}",
                    "originalReleaseDate": "{{vars.item.originalReleaseDate}}",
                    "countriesAreasDeployed": "{{vars.item.countriesAreasDeployed}}",
                    "criticalInfrastructureSector": "{{vars.item.criticalInfrastructureSector}}"
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/i_c_s_advisories",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "__dummy": "{{vars.recordIRI.extend(vars.steps.Create_ICS_Advisory_Record | json_query('[*][\"@id\"][]'))}}",
                    "cVEiCSAdvisoryDict": "{% set output = {} %}\n{% for data in vars.cVE %}\n{% set iri = data['@id'] %}\n{% set _ = output.update({iri: []}) %}\n{% for item in vars.steps.Create_ICS_Advisory_Record %}\n{% if data.cVEID in item.cVEID %}\n{% set _ = output[iri].append(item['@id']) %}\n{% endif %}\n{% endfor %}\n{% endfor %}\n{{output}}"
                }
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "f89d28a8-1e25-410c-b47b-611e30a5e78a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "cVEData": "{{vars.extractedText['cVEData']}}",
                "recordIRI": "[]",
                "sSVCSchema": "{\n  \"Exploitation\": \"\",\n  \"Technical Impact\": \"\",\n  \"Automatable\": \"\",\n  \"Mission Prevalence\": \"\",\n  \"Well Being\": \"\",\n  \"Mitigation Status\": \"\",\n  \"Automatable Reason\": \"\"\n}",
                "sourceData": "{\n  \"id\": \"d3ccb59f-0eae-4987-84aa-e9eb83edfb57\",\n  \"ack\": false,\n  \"name\": \"Inactive protocol OFF\",\n  \"note\": null,\n  \"risk\": \"0.0\",\n  \"time\": 1678918306912,\n  \"id_dst\": \"224.0.0.252\",\n  \"id_src\": \"10.132.254.110\",\n  \"ip_dst\": \"224.0.0.252\",\n  \"ip_src\": \"10.132.254.110\",\n  \"status\": \"open\",\n  \"mac_dst\": \"01:00:5e:00:00:fc\",\n  \"mac_src\": \"00:0c:29:5f:74:57\",\n  \"parents\": [],\n  \"type_id\": \"NET:INACTIVE-PROTOCOL\",\n  \"port_dst\": null,\n  \"port_src\": null,\n  \"protocol\": \"llmnr\",\n  \"severity\": 0,\n  \"zone_dst\": \"Multicast\",\n  \"zone_src\": \"10.132.0.0\/16\",\n  \"dst_roles\": \"other\",\n  \"label_dst\": null,\n  \"label_src\": \"FSR-PROD-WIN10-\",\n  \"src_roles\": \"other\",\n  \"type_name\": \"Inactive protocol\",\n  \"types_dst\": [\n    \"broadcast\"\n  ],\n  \"types_src\": [\n    \"computer\"\n  ],\n  \"bpf_filter\": \"(ip host 10.132.254.110 and ip host 224.0.0.252 and (udp port 5355)) or (vlan and ip host 10.132.254.110 and ip host 224.0.0.252 and (udp port 5355))\",\n  \"levels_dst\": [\n    \"\"\n  ],\n  \"levels_src\": [\n    \"\"\n  ],\n  \"properties\": {\n    \"raised_by\": \"n2os_ids\",\n    \"mitre_attack_for_ics\": {\n      \"source\": {\n        \"types\": [\n          \"Engineering Workstation\"\n        ]\n      }\n    }\n  },\n  \"replicated\": false,\n  \"session_id\": null,\n  \"trigger_id\": null,\n  \"closed_time\": 0,\n  \"description\": \"Link is active\",\n  \"is_incident\": false,\n  \"is_security\": false,\n  \"threat_name\": \"\",\n  \"appliance_id\": \"1fb4918e-ed88-4717-82ec-28fec97dd6be\",\n  \"appliance_ip\": \"10.132.254.15\",\n  \"created_time\": 1678918306912,\n  \"synchronized\": false,\n  \"trigger_type\": null,\n  \"incident_keys\": [],\n  \"appliance_host\": \"nozomi-n2os.local\",\n  \"appliance_site\": null,\n  \"capture_device\": \"\",\n  \"assertion_source\": \"\",\n  \"transport_protocol\": \"unknown\",\n  \"sec_profile_visible\": true,\n  \"mitre_attack_tactics\": null,\n  \"additional_description\": {},\n  \"mitre_attack_techniques\": null\n}",
                "kEVAlertData": "{{vars.extractedText['kEVAlertData']}}",
                "iCSAdvisoryData": "{{vars.extractedText['iCSAdvisoryData']}}"
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "708ae4ac-c69b-43c5-b8a0-5f1527d2c9c4"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Alerts",
            "description": null,
            "arguments": {
                "resource": {
                    "name": "Inactive protocol OFF",
                    "type": "\/api\/3\/picklists\/574a6ee2-7265-4701-815e-cff83b053bce",
                    "state": "\/api\/3\/picklists\/a1bac09b-1441-45aa-ad1b-c88744e48e72",
                    "source": "Nozomi Networks Central Management Console",
                    "status": "\/api\/3\/picklists\/7de816ff-7140-4ee5-bd05-93ce22002146",
                    "fsrQueue": "\/api\/3\/fsr_queues\/4cf6073b-319d-4c30-887c-f642adfede82",
                    "severity": "\/api\/3\/picklists\/58d0753f-f7e4-403b-953c-b0f521eab759",
                    "sourceId": "d3ccb59f-0eae-4987-84aa-e9eb83edfb51",
                    "sourceIp": "10.132.254.110",
                    "__replace": "",
                    "epochTime": "1678918306912",
                    "eventTime": "2023-03-15T22:11:46Z",
                    "recordTags": [
                        "\/api\/3\/tags\/Alerts"
                    ],
                    "sourcedata": "{{vars.sourceData | toJSON}}",
                    "description": "<table border=\\\"1\\\"><thead><tr><th width=\\\"250\\\">Fields<\/th><th width=\\\"250\\\">Values<\/th><\/tr><\/thead>\n<tbody>\n<tr><td>Description<\/td>\n<td>Link is active<\/td><\/tr>\n<td>Risk<\/td>\n<td>0.0<\/td><\/tr>\n<td>Type ID<\/td>\n<td>NET:INACTIVE-PROTOCOL<\/td><\/tr>\n<td>Protocol<\/td>\n<td>llmnr<\/td><\/tr>\n<td>Transport Protocol<\/td>\n<td>unknown<\/td><\/tr>\n<\/tbody>\n<\/table>\n<table border=\\\"1\\\"><thead><tr><th width=\\\"250\\\">Source Fields<\/th><th width=\\\"250\\\">Source Values<\/th><\/tr><\/thead>\n<tbody>\n<tr><td>Source ID<\/td>\n<td>10.132.254.110<\/td><\/tr>\n<td>MAC Source Address<\/td>\n<td>00:0c:29:5f:74:57<\/td><\/tr>\n<td>Source Roles<\/td>\n<td>other<\/td><\/tr>\n<td>Source Types<\/td>\n<td>['computer']<\/td><\/tr>\n<\/tbody>\n<\/table>\n<table border=\\\"1\\\"><thead><tr><th width=\\\"250\\\">Destination Fields<\/th><th width=\\\"250\\\">Destination Values<\/th><\/tr><\/thead>\n<tbody>\n<tr><td>Destination ID<\/td>\n<td>224.0.0.252<\/td><\/tr>\n<td>MAC Destination Address<\/td>\n<td>01:00:5e:00:00:fc<\/td><\/tr>\n<td>Destination Roles<\/td>\n<td>other<\/td><\/tr>\n<td>Destination Types<\/td>\n<td>['broadcast']<\/td><\/tr>\n<\/tbody>\n<\/table>\n<\/table>",
                    "ackSlaStatus": "\/api\/3\/picklists\/72979f64-e8b9-4888-a965-957e0ec24818",
                    "destinationIp": "224.0.0.252",
                    "respSlaStatus": "\/api\/3\/picklists\/72979f64-e8b9-4888-a965-957e0ec24818",
                    "priorityWeight": 1,
                    "escalatedtoincident": "\/api\/3\/picklists\/2128a09c-153d-4db3-985d-de6be33deae5",
                    "alertRemainingAckSLA": 0
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/alerts",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "__dummy": "{{vars.recordIRI.append(vars.steps.Create_Alerts['@id'])}}"
                }
            },
            "status": null,
            "top": "1110",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "46ae2af2-60cf-4786-b130-ea2c320ee0b3"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create CVEs Record",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.cVEData}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "sSVC": "{{vars.item.sSVC}}",
                    "cVEID": "{{vars.item.cVEID}}",
                    "cWEID": "{{vars.item.cWEID}}",
                    "cVEURL": "{{vars.item.cVEURL}}",
                    "cVSSv2": "{{vars.item.cVSSv2}}",
                    "cVSSv3": "{{vars.item.cVSSv3}}",
                    "__replace": "false",
                    "reference": "{{vars.item.reference}}",
                    "cPEsDetail": "{{vars.item.cPEsDetail}}",
                    "recordTags": "{{vars.item.recordTags}}",
                    "sourceData": "{{vars.item.sourceData}}",
                    "description": "{{vars.item.description}}",
                    "kEVTagSource": "{{vars.item.kEVTagSource['@id']}}",
                    "publishedDate": "{{vars.item.publishedDate}}",
                    "isInKEVCatalog": "{{vars.item.isInKEVCatalog['@id']}}",
                    "lastModifiedOn": "{{vars.item.lastModifiedOn}}",
                    "evaluatorImpact": "{{vars.item.evaluatorImpact}}",
                    "identifierSource": "{{vars.item.identifierSource}}",
                    "vendorStatements": "{{vars.item.vendorStatementsisInKEVCatalog}}",
                    "evaluatorSolution": "{{vars.item.evaluatorImpact}}",
                    "vulnerabilityScore": "<p>{{vars.item.vulnerabilityScore}}<\/p>",
                    "vulnerabilityStatus": "{{vars.item.vulnerabilityStatus['@id']}}"
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/c_v_es",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": {
                    "cVE": "{{vars.steps.Create_CVEs_Record | flatten}}",
                    "__dummy": "{{vars.recordIRI.extend(vars.steps.Create_CVEs_Record | flatten | json_query('[*][\"@id\"][]'))}}"
                }
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "46b5203c-0d2c-4488-9f92-ee8464fb82be"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get JSON Data",
            "description": null,
            "arguments": {
                "query": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": [
                        {
                            "type": "primitive",
                            "field": "name",
                            "value": "Nozomi - Sample Data",
                            "operator": "eq",
                            "_operator": "eq"
                        }
                    ]
                },
                "module": "attachments?$limit=30",
                "step_variables": []
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928770",
            "group": null,
            "uuid": "e8de1879-e154-4e1f-96bc-c20dd2eb24fb"
        },
        {
            "@type": "WorkflowStep",
            "name": "Extract Artifacts",
            "description": null,
            "arguments": {
                "name": "File Content Extraction",
                "config": "70616ece-f92a-459b-88e5-cbf1b07b37b2",
                "params": {
                    "file_iri": "{{vars.steps.Get_JSON_Data[0].file['@id']}}",
                    "html_output_format": false
                },
                "version": "1.0.3",
                "connector": "file-content-extraction",
                "operation": "extract_text",
                "operationTitle": "Extract Text",
                "pickFromTenant": false,
                "step_variables": {
                    "extractedText": "{{vars.steps.Extract_Artifacts.data['extracted_text']}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "b6b517b5-4fac-4bc0-9ad5-aff828a27d2c"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Extract Artifacts -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/708ae4ac-c69b-43c5-b8a0-5f1527d2c9c4",
            "sourceStep": "\/api\/3\/workflow_steps\/b6b517b5-4fac-4bc0-9ad5-aff828a27d2c",
            "label": null,
            "isExecuted": false,
            "uuid": "3df678f2-1918-4c2d-bb4a-1ec1ed36959a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create CVEs Record -> Create ICS Advisory Record",
            "targetStep": "\/api\/3\/workflow_steps\/f89d28a8-1e25-410c-b47b-611e30a5e78a",
            "sourceStep": "\/api\/3\/workflow_steps\/46b5203c-0d2c-4488-9f92-ee8464fb82be",
            "label": null,
            "isExecuted": false,
            "uuid": "57c2df29-d13f-4987-a702-d29a45e5fbbe"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Alerts -> Output",
            "targetStep": "\/api\/3\/workflow_steps\/03551ca8-7d51-405d-88b7-2451ac00f25a",
            "sourceStep": "\/api\/3\/workflow_steps\/46ae2af2-60cf-4786-b130-ea2c320ee0b3",
            "label": null,
            "isExecuted": false,
            "uuid": "6e720c13-1cab-4623-a6f4-1b234023e4a0"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Create CVEs Record",
            "targetStep": "\/api\/3\/workflow_steps\/46b5203c-0d2c-4488-9f92-ee8464fb82be",
            "sourceStep": "\/api\/3\/workflow_steps\/708ae4ac-c69b-43c5-b8a0-5f1527d2c9c4",
            "label": null,
            "isExecuted": false,
            "uuid": "7b65aae1-c5ce-4a60-8182-abc0fb09755d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Get JSON Data",
            "targetStep": "\/api\/3\/workflow_steps\/e8de1879-e154-4e1f-96bc-c20dd2eb24fb",
            "sourceStep": "\/api\/3\/workflow_steps\/b9930846-6b76-4976-b0ef-88a81106b5d7",
            "label": null,
            "isExecuted": false,
            "uuid": "95dadfaf-806f-4c48-852a-20841163de45"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get JSON Data -> Extract Artifacts",
            "targetStep": "\/api\/3\/workflow_steps\/b6b517b5-4fac-4bc0-9ad5-aff828a27d2c",
            "sourceStep": "\/api\/3\/workflow_steps\/e8de1879-e154-4e1f-96bc-c20dd2eb24fb",
            "label": null,
            "isExecuted": false,
            "uuid": "b2c4cac8-a529-4561-84d3-0b4baa58d97f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create KEV Alerts -> Create Alerts",
            "targetStep": "\/api\/3\/workflow_steps\/46ae2af2-60cf-4786-b130-ea2c320ee0b3",
            "sourceStep": "\/api\/3\/workflow_steps\/335ddb91-9138-4315-bc5f-777f81bad82b",
            "label": null,
            "isExecuted": false,
            "uuid": "c090bf59-003b-45f4-a14e-fbbc562d7ae3"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update CVEs With ICS Advisory -> Create KEV Alerts",
            "targetStep": "\/api\/3\/workflow_steps\/335ddb91-9138-4315-bc5f-777f81bad82b",
            "sourceStep": "\/api\/3\/workflow_steps\/98962208-3d6f-4b65-9958-43619ed06a4b",
            "label": null,
            "isExecuted": false,
            "uuid": "f0780de5-6ba9-4a0d-9a35-88451f28fc47"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create ICS Advisory Record -> Update CVEs With ICS Advisory",
            "targetStep": "\/api\/3\/workflow_steps\/98962208-3d6f-4b65-9958-43619ed06a4b",
            "sourceStep": "\/api\/3\/workflow_steps\/f89d28a8-1e25-410c-b47b-611e30a5e78a",
            "label": null,
            "isExecuted": false,
            "uuid": "f5770179-ab1d-480c-beef-c6aa527e7f8f"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "f9bdb309-cc12-461f-9613-0d9d08f11406",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Alert",
        "Scenario",
        "OT IT",
        "KEV",
        "CVE",
        "Nozomi",
        "ICS Advisory"
    ]
}